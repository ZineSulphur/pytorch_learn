# R-CNN

R-CNN的全称是Region-CNN，是第一个成功将深度学习应用到目标检测上的算法。

## R-CNN

R-CNN算法流程可分为4个步骤
- 一张图像生成1K-2K个候选区域(Selective Search)
- 对每个候选区域，使用深度网络提取特征
- 特征送入每一类SVM分类器，判别是否属于该类
- 使用回归器精细修正候选框位置

### 候选区域生成

利用 Selective Search 算法通过图像分割的方法得到一些原始区域，然后利用一些合并策略将这些区域合并，得到一些层次化的区域结构，而这些结构就包含着可能需要的物体。

选择搜索算法SS的主要思想：图像中物体可能存在的区域应该是有某些相似性或者连续性区域的。首先，对输入图像进行分割算法产生许多小的子区域。其次，根据这些子区域之间相似性(相似性标准主要有颜色、纹理、大小等等)进行区域合并，不断的进行区域迭代合并。每次迭代过程中对这些合并的子区域做bounding boxes(外切矩形)，这些子区域外切矩形就是通常所说的候选框。

![RCNN候选区域](./img/rcnn1.png)

### 特征提取

将SS算法选出的2000个候选区域缩放到227x227，接着将其输入到事先训练好的AlexNet CNN网络中，获取4096维的特征得到2000x4096维矩阵。

![RCNN特征提取](./img/rcnn2.png)

### 分类器分类

将2000x4096的特征矩阵和20个SVM权值矩阵4096x20矩阵相乘，得到2000x20的矩阵代表每个建议框归属每个目标类别的概率。

分别对上面的每一类进行非极大值抑制NMS提出重叠建议框，得到该类中得分最高的一些建议框。

NMS算法首先寻找得分最高的目标，然后计算其它目标与该目标的IoU值，然后去除高于阈值的目标。

![NMS](./img/rcnn3.png)

### 回归器精细修正

对NMS处理后剩余的建议框进行进一步筛选，即用20个回归器对20个分类的建议框进行回归，得到每个类别修正后得分最高的框。

### R-CNN结构

![RCNN结构](./img/r-cnn.svg)

### 缺点

- 测试速度慢
- 训练速度慢，所需空间大

    R-CNN需要同时对CNN网络，SVM分类器和回归器进行训练，所需开销较大，过程繁琐。

## 参考

[R-CNN系列巨详细解读](https://zhuanlan.zhihu.com/p/658024219)

[Faster RCNN理论合集](https://www.bilibili.com/video/BV1af4y1m7iL/)

[动手学深度学习](https://zh-v2.d2l.ai/chapter_computer-vision/rcnn.html#id5)